var CANVAS_MAIL=function(e){"use strict";function t(e){return e.toLowerCase().replace(/(?:^|\W)\w/g,function(e){return e.toUpperCase()})}function n(e){var t,n;return t=e.split(" "),n=t.shift(),function(e){return{overline:{line_height:0,thickness:e/12},"line-through":{line_height:e/2,thickness:e/20},underline:{line_height:e,thickness:e/12},none:{line_height:0,thickness:0}}[n]}}function s(e){if("none"===e)return null;var t=e.split(" ");return{blur:parseInt(t.pop(),10),v_shadow:parseInt(t.pop(),10),h_shadow:parseInt(t.pop(),10),color:t.join(" ")}}function o(t,n){var s,o,r;return s=e("<span></span>"),s.text(t),s.css("font",n),e(document.documentElement).append(s),o=s.height(),r=s.width(),s.remove(),{height:o,width:r}}function r(e,t,r,c,i,a,h,l){var f,p,d;return t=u[h](t),l=s(l),f=o(t,r),e.attr(f),p=e[0].getContext("2d"),p.save(),p.fillStyle=i,p.font=r,p.textAlign="left",p.textBaseline="top",l&&(p.shadowBlur=l.blur,p.shadowOffsetY=l.v_shadow,p.shadowOffsetX=l.h_shadow,p.shadowColor=l.color),p.fillText(t,0,0),p.restore(),d=n(a)(c),0!==d.thickness&&(p.beginPath(),p.strokeStyle=i,p.lineWidth=d.thickness,p.moveTo(0,d.line_height),p.lineTo(f.width,d.line_height),p.stroke(),p.restore()),e}function c(e,t,n,s){return r(t,n+"@"+s,e.css("font"),parseInt(e.css("font-size"),10),e.css("color"),e.css("text-decoration"),e.css("text-transform"),e.css("text-shadow"))}function i(e,t,n){var s,o,r,c,i,u,a;return s="mailto:"+e+"@"+t,o=n.cc_users.map(function(e,t){return e+"@"+n.cc_domains[t]}).join(","),r=n.bcc_users.map(function(e,t){return e+"@"+n.bcc_domains[t]}).join(","),c=encodeURI(n.subject||""),i=encodeURI(n.body||""),u=[],o&&u.push("cc="+o),r&&u.push("bcc="+r),c&&u.push("subject="+c),i&&u.push("body="+i),a=u.join("&"),a?s+"?"+a:s}var u,a={};return u={none:function(e){return e},capitalize:t,uppercase:function(e){return e.toUpperCase()},lowercase:function(e){return e.toLowerCase()}},a.render_email=function(t,n,s,o){o=o||{},o.cc_users=o.cc_users||[],o.cc_domains=o.cc_domains||[],o.bcc_users=o.bcc_users||[],o.bcc_domains=o.bcc_domains||[],t.each(function(){var t=e(this),r=e("<canvas></canvas>");r.css("vertical-align","text-top"),c(t,r,n,s),t.empty(),t.append(r),"A"===t.prop("tagName")&&(t.mouseover(function(){e(this).attr("href",i(n,s,o))}),t.mouseout(function(){e(this).attr("href",null)}),t.hover(function(){c(t,r,n,s)},function(){c(t,r,n,s)}))})},a}(jQuery);